{% extends "app.html.j2" %} {% block title %}Dashboard | {% endblock %} {% block app %}

<div id="main" class="bg-light p-5 text-dark flex flex-col absolute top-0 left-0 right-0 bottom-0 overflow-scroll" v-cloak>
  <div class="grid grid-cols-1 gap-5">
    <div class="border border-secondary bg-white p-5" v-if="!store.state.auth.profile">
      <p>Please wait, we're loading your dashboard.</p>
    </div>
    <div class="p-5" :class="_.isEmpty(store.state.auth.profile) ? 'border border-secondary bg-white' : 'bg-gray-55'" v-if="store.state.auth.profile">
      <p v-if="_.isEmpty(store.state.auth.profile)">You are logged out. <a href="javascript:void(0)" @click="store.commit('auth/login', true)">Click here to login.</a></p>
      <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center" v-else>
        <div class="pb-5 lg:pb-0">
          <h5 class="text-xl font-light text-white">Welcome, {{store.state.auth.profile.email}}!</h5>
          <p class="text-xs font-light text-gray-40">(This is your private dashboard. <a class="text-white" :href="'/user/' + store.state.auth.profile.username + '/?mode=popup'" v-on:click.prevent="POPUP(event.currentTarget.href, 'popup-user-' + _.uniqueId(), 0.7, window)">Click here</a> to view your public profile.)</p>
        </div>
        <div>
          <a :href="ACCOUNTURL + '/dashboard/'" class="btn btn-sm btn-white mr-1" target="_blank">Manage Your Account</a>
          <button class="btn btn-sm btn-white" @click="store.commit('auth/logout', true)">Log Out</button>
        </div>
      </div>
    </div>
    <template v-if="!_.isEmpty(store.state.auth.profile) && !_.isNull(lists)">
      <div class="border border-secondary bg-white p-5" v-for="status in ['public', 'hidden']">
        <div class="flex justify-between items-center mb-3">
          <h5 class="text-xl font-light text-dark-gray">Your {{_.startCase(status)}} Lists</h5>
          <a :href="'/create/list/?visibility=' + status" class="btn btn-sm btn-gray font-semibold">&plus;</a>
        </div>
        <p class="font-light mb-5" v-if="status == 'public'">These lists show up on your public profile and can be viewed or cloned by other users.</p>
        <p class="font-light mb-5" v-else>These lists are hidden from public searches.</p>
        <div class="bg-xlight text-xs p-3" v-if="_.isEmpty(_.filter(lists, {visibility: status}))">
          You don't have any {{status}} lists.
        </div>
        <listpaginator :lists="_.filter(lists, {visibility: status})" :hide="['visibility', 'created_by']" @toggle="toggleList" @confirm="confirmDelete"></listpaginator>
      </div>
    </template>
    <div class="border border-secondary bg-white p-5" v-if="!_.isEmpty(store.state.auth.profile) && !_.isNull(bookmarks)">
      <h5 class="text-xl font-light text-dark-gray mb-3">Your Bookmarks</h5>
      <p class="font-light mb-5">Bookmarks help you keep track of results you want to revisit. Your collection of bookmarks is private and is not viewable by other users.</p>
      <div class="bg-xlight text-xs p-3" v-if="_.isEmpty(bookmarks)">
        You don't have any bookmarks.
      </div>
      <bookmarks :bookmarks="bookmarks" @update="updateBookmarks" v-else></bookmarks>
    </div>
  </div>
  <p class="text-xs pt-5 mt-auto">[[copyright()]]</p>
  <modal :show="confirm.modal" @cancel="confirm.modal = false">
    <div slot="header">
      <h5 class="modal-title">Confirm List Deletion</h5>
      <p class="modal-subtitle">Are you sure you want to delete this list?</p>
    </div>
    <div slot="body">
      <div class="alert alert-warning"><strong>WARNING:</strong> The deletion of lists is irreversible. You are deleting the list with name <u>{{confirm.name}}</u> and ID <u>{{confirm.id}}</u>.</div>
    </div>
    <div slot="footer" class="flex justify-end">
      <button type="button" @click="confirm.modal = false" class="btn btn-sm btn-secondary mr-1">Cancel</button>
      <button type="button" @click="deleteList(); confirm.modal = false" class="btn btn-sm btn-gray">Confirm</button>
    </div>
  </modal>
</div>

{% endblock %}
{% block scripts %}

<script src="[[ url_for('static', filename='js/blocks/bookmarks.js') ]]"></script>
<script src="[[ url_for('static', filename='js/blocks/list/listdisplayer.js') ]]"></script>
<script src="[[ url_for('static', filename='js/blocks/list/listpaginator.js') ]]"></script>
<script src="[[ url_for('static', filename='js/modules/dashboard.js') ]]"></script>

{% endblock %}
