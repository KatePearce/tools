{% extends "app.html.j2" %} {% block title %}Dashboard | {% endblock %} {% block app %}

<div id="main" class="bg-light p-5 text-dark flex flex-col absolute top-0 left-0 right-0 bottom-0 overflow-scroll" v-cloak>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
    <div class="border border-secondary bg-white p-5 lg:col-span-2" v-if="!store.state.auth.profile">
      <p>Please wait, we're loading your dashboard.</p>
    </div>
    <div class="p-5 lg:col-span-2" :class="_.isEmpty(store.state.auth.profile) ? 'border border-secondary bg-white' : 'bg-gray-55'" v-if="store.state.auth.profile">
      <p v-if="_.isEmpty(store.state.auth.profile)">You are logged out. <a href="javascript:void(0)" @click="store.commit('auth/login', true)">Click here to login.</a></p>
      <div class="flex flex-col lg:flex-row lg:justify-between lg:items-center" v-else>
        <div class="pb-5 lg:pb-0">
          <h5 class="text-xl font-light text-white">Welcome, {{store.state.auth.profile.email}}!</h5>
          <p class="text-xs font-light text-gray-40">(This is your private dashboard. <a class="text-white" :href="'/user/' + store.state.auth.profile.username + '/?mode=popup'" v-on:click.prevent="POPUP(event.currentTarget.href, 'popup-user-' + _.uniqueId(), 0.7, window)">Click here</a> to view your public profile.)</p>
        </div>
        <div>
          <a :href="ACCOUNTURL + '/dashboard/'" class="btn btn-sm btn-white mr-1" target="_blank">Manage Your Account</a>
          <button class="btn btn-sm btn-white" @click="store.commit('auth/logout', true)">Log Out</button>
        </div>
      </div>
    </div>
    <div>
      <tabs v-if="!_.isEmpty(store.state.auth.profile) && !_.isNull(lists)" :fill="true">
        <tab :name="_.startCase(status) + ' Lists'" class="p-5" v-for="status in ['public', 'hidden']" :selected="status == 'public'">
          <p class="font-light text-sm mb-5" v-if="status == 'public'">These lists show up on your public profile and can be viewed and cloned by other users.</p>
          <p class="font-light text-sm mb-5" v-else>These lists are hidden from public searches.</p>
          <div class="bg-xlight text-xs p-3" v-if="_.isEmpty(_.filter(lists, {visibility: status}))">
            You don't have any {{status}} lists.
          </div>
          <listpaginator :lists="_.filter(lists, {visibility: status})" :hide="['visibility', 'created_by']" @toggle="toggleList" @confirm="confirmList"></listpaginator>
        </tab>
      </tabs>
    </div>
    <div>
      <tabs v-if="!_.isEmpty(store.state.auth.profile) && !_.isNull(queries)" :fill="true">
        <tab :name="_.startCase(status) + ' Queries'" class="p-5" v-for="status in ['public', 'hidden']" :selected="status == 'public'">
          <p class="font-light text-sm mb-5" v-if="status == 'public'">These queries show up on your public profile and can be viewed and cloned by other users.</p>
          <p class="font-light text-sm mb-5" v-else>These queries are hidden from public searches.</p>
          <div class="bg-xlight text-xs p-3" v-if="_.isEmpty(_.filter(queries, {visibility: status}))">
            You don't have any {{status}} queries.
          </div>
          <querypaginator :queries="_.filter(queries, {visibility: status})" :hide="['visibility', 'created_by']" @toggle="toggleQuery" @confirm="confirmQuery"></querypaginator>
        </tab>
      </tabs>
    </div>
  </div>
  <p class="text-xs pt-5 mt-auto">[[copyright()]]</p>
  <modal :show="confirm.list.modal" @cancel="confirm.list.modal = false">
    <div slot="header">
      <h5 class="modal-title">Confirm List Deletion</h5>
      <p class="modal-subtitle">Are you sure you want to delete this list?</p>
    </div>
    <div slot="body">
      <div class="alert alert-warning"><strong>WARNING:</strong> The deletion of lists is irreversible. You are deleting the list with name <u>{{confirm.list.name}}</u> and ID <u>{{confirm.list.id}}</u>.</div>
    </div>
    <div slot="footer" class="flex justify-end">
      <button type="button" @click="confirm.list.modal = false" class="btn btn-sm btn-secondary mr-1">Cancel</button>
      <button type="button" @click="deleteList(); confirm.list.modal = false" class="btn btn-sm btn-gray">Confirm</button>
    </div>
  </modal>
  <modal :show="confirm.query.modal" @cancel="confirm.query.modal = false">
    <div slot="header">
      <h5 class="modal-title">Confirm Query Deletion</h5>
      <p class="modal-subtitle">Are you sure you want to delete this query?</p>
    </div>
    <div slot="body">
      <div class="alert alert-warning"><strong>WARNING:</strong> The deletion of queries is irreversible. You are deleting the query with name <u>{{confirm.query.name}}</u> and ID <u>{{confirm.query.id}}</u>.</div>
    </div>
    <div slot="footer" class="flex justify-end">
      <button type="button" @click="confirm.query.modal = false" class="btn btn-sm btn-secondary mr-1">Cancel</button>
      <button type="button" @click="deleteQuery(); confirm.query.modal = false" class="btn btn-sm btn-gray">Confirm</button>
    </div>
  </modal>
</div>

{% endblock %}
{% block scripts %}

<script src="[[ url_for('static', filename='js/blocks/list/listdisplayer.js') ]]"></script>
<script src="[[ url_for('static', filename='js/blocks/list/listpaginator.js') ]]"></script>
<script src="[[ url_for('static', filename='js/blocks/query/querydisplayer.js') ]]"></script>
<script src="[[ url_for('static', filename='js/blocks/query/querypaginator.js') ]]"></script>
<script src="[[ url_for('static', filename='js/modules/dashboard.js') ]]"></script>

{% endblock %}
